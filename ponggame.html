<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vertical Pong</title>
<style>
body {
  background: #111;
  color: white;
  text-align: center;
  font-family: Arial, sans-serif;
  margin: 0;
}
canvas {
  background: black;
  display: block;
  margin: 20px auto;
  border: 2px solid white;
}
button {
  margin: 5px;
  padding: 8px 14px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 6px;
  border: none;
}
#levelPopup {
  position: absolute;
  top: 80px;
  left: calc(50% + 220px);
  background: #222;
  border: 2px solid white;
  padding: 10px;
  display: flex;
  flex-direction: column;
}
#levelPopup button {
  margin: 5px 0;
}
#helpBtn {
  position: absolute;
  top: 20px;
  left: calc(50% + 220px);
  font-size: 20px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #222;
  color: white;
  border: 2px solid white;
}
#helpText {
  position: absolute;
  top: 70px;
  left: calc(50% + 220px);
  width: 200px;
  background: #333;
  border: 2px solid white;
  padding: 10px;
  display: none;
  text-align: left;
}
</style>
</head>
<body>
<h1>Vertical Pong</h1>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<p id="score">Player: 0 | Computer: 0 | Level: 1</p>
<button id="playPauseBtn">Play</button>
<button onclick="window.open('https://chat.openai.com/', '_blank')">Open Chat History</button>
<p id="result" style="font-size:20px; font-weight:bold;"></p>

<!-- Level Selector -->
<div id="levelPopup">
  <strong>Choose Level</strong>
  <button onclick="setLevel(1)">Level 1</button>
  <button onclick="setLevel(2)">Level 2</button>
  <button onclick="setLevel(3)">Level 3</button>
</div>

<!-- Help Button -->
<button id="helpBtn">?</button>
<div id="helpText">
  <strong>How to Play:</strong>
  <ul>
    <li>Use <b>Left</b> and <b>Right</b> arrow keys to move your paddle.</li>
    <li>Hit the ball with your paddle. Moving the paddle while hitting increases ball speed.</li>
    <li>First to 10 points wins.</li>
    <li>Select levels 1-3 to adjust difficulty.</li>
    <li>Computer paddle moves automatically. Try to beat it!</li>
  </ul>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const playPauseBtn = document.getElementById("playPauseBtn");
const resultText = document.getElementById("result");
const helpBtn = document.getElementById("helpBtn");
const helpText = document.getElementById("helpText");

let paddleWidth = 80, paddleHeight = 10;
let playerX = canvas.width/2 - paddleWidth/2;
const playerY = canvas.height - 30;
let playerPrevX = playerX;

let computerX = canvas.width/2 - paddleWidth/2;
const computerY = 20;
let computerPrevX = computerX;

let ballX = canvas.width/2, ballY = canvas.height/2;
let ballSpeedX = 3, ballSpeedY = 3;
const ballRadius = 8;

let rightPressed=false, leftPressed=false;
let playerScore=0, computerScore=0, level=1;
const winScore = 10;
let playing=false, gameOver=false;

const speeds = {1:{ball:3, ai:2},2:{ball:4, ai:3},3:{ball:5, ai:4}};

// Controls
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowRight") rightPressed=true;
  if(e.key==="ArrowLeft") leftPressed=true;
});
document.addEventListener("keyup", e=>{
  if(e.key==="ArrowRight") rightPressed=false;
  if(e.key==="ArrowLeft") leftPressed=false;
});

// Help button toggle + pause
helpBtn.addEventListener("click", ()=>{
  helpText.style.display = helpText.style.display === "none" ? "block" : "none";
  if(helpText.style.display === "block") {
    playing = false; // pause game when help is open
    playPauseBtn.innerText = "Play";
  }
});

// Play/Pause
playPauseBtn.addEventListener("click", ()=>{
  if(gameOver) resetGame();
  playing=!playing;
  playPauseBtn.innerText = playing?"Pause":"Play";
});

function setLevel(lv){
  level=lv;
  resetBall();
}

// Draw functions
function drawPaddle(x,y){ctx.fillStyle="white"; ctx.fillRect(x,y,paddleWidth,paddleHeight);}
function drawBall(){ctx.beginPath(); ctx.arc(ballX,ballY,ballRadius,0,Math.PI*2); ctx.fillStyle="red"; ctx.fill(); ctx.closePath();}

// Reset
function resetBall(){
  ballX=canvas.width/2;
  ballY=canvas.height/2;
  let speed = speeds[level].ball;
  ballSpeedX = (Math.random()>0.5?1:-1)*speed;
  ballSpeedY = (Math.random()>0.5?1:-1)*speed;
}

function resetGame(){
  playerScore=0; computerScore=0; gameOver=false;
  resultText.innerText="";
  playPauseBtn.innerText="Play";
  resetBall();
}

// Update game
function update(){
  if(!playing || gameOver) return;

  // Paddle movement (player)
  if(rightPressed) playerX += 6;
  if(leftPressed) playerX -= 6;
  if(playerX<0) playerX=0;
  if(playerX+paddleWidth>canvas.width) playerX=canvas.width-paddleWidth;
  let playerVel = playerX - playerPrevX;

  // Computer AI
  let compCenter = computerX + paddleWidth/2;
  const aiSpeed = speeds[level].ai;
  const errorMargin = 40 - level*10;
  if(Math.abs(ballX - compCenter) > errorMargin){
    if(compCenter<ballX) computerX+=aiSpeed;
    else computerX-=aiSpeed;
  }
  if(computerX<0) computerX=0;
  if(computerX+paddleWidth>canvas.width) computerX=canvas.width-paddleWidth;
  let computerVel = computerX - computerPrevX;

  // Predictive collision for player
  if(ballSpeedY>0 && ballY+ballRadius >= playerY && ballY-ballRadius <= playerY+paddleHeight){
    if(ballX + ballRadius >= playerX && ballX - ballRadius <= playerX+paddleWidth){
      ballSpeedY = -Math.abs(ballSpeedY);
      ballSpeedX += playerVel*0.3;
      ballY = playerY - ballRadius;
    }
  }

  // Predictive collision for computer
  if(ballSpeedY<0 && ballY-ballRadius <= computerY+paddleHeight && ballY+ballRadius >= computerY){
    if(ballX + ballRadius >= computerX && ballX - ballRadius <= computerX+paddleWidth){
      ballSpeedY = Math.abs(ballSpeedY);
      ballSpeedX += computerVel*0.3;
      ballY = computerY + paddleHeight + ballRadius;
    }
  }

  // Update ball
  ballX += ballSpeedX;
  ballY += ballSpeedY;

  // Bounce walls
  if(ballX-ballRadius<0 || ballX+ballRadius>canvas.width) ballSpeedX=-ballSpeedX;

  // Scoring
  if(ballY>canvas.height){computerScore++; resetBall();}
  if(ballY<0){playerScore++; resetBall();}

  // Check win/lose
  if(playerScore>=winScore){resultText.innerText="ðŸŽ‰ You Win!"; gameOver=true; playing=false; playPauseBtn.innerText="Restart";}
  if(computerScore>=winScore){resultText.innerText="ðŸ˜¢ You Lose!"; gameOver=true; playing=false; playPauseBtn.innerText="Restart";}

  playerPrevX = playerX;
  computerPrevX = computerX;
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPaddle(playerX,playerY);
  drawPaddle(computerX,computerY);
  drawBall();
  document.getElementById("score").innerText = `Player: ${playerScore} | Computer: ${computerScore} | Level: ${level}`;
}

// Loop
function gameLoop(){update(); draw(); requestAnimationFrame(gameLoop);}
resetBall(); gameLoop();
</script>
</body>
</html>
